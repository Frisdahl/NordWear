generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model cart_item {
  id         Int      @id @default(autoincrement())
  customerId Int
  productId  Int
  sizeId     Int
  colorId    Int
  quantity   Int
  color      color    @relation(fields: [colorId], references: [id], map: "Cart_Item_colorId_fkey")
  customer   customer @relation(fields: [customerId], references: [id], map: "Cart_Item_customerId_fkey")
  product    product  @relation(fields: [productId], references: [id], map: "Cart_Item_productId_fkey")
  size       size     @relation(fields: [sizeId], references: [id], map: "Cart_Item_sizeId_fkey")

  @@index([colorId], map: "Cart_Item_colorId_fkey")
  @@index([customerId], map: "Cart_Item_customerId_fkey")
  @@index([productId], map: "Cart_Item_productId_fkey")
  @@index([sizeId], map: "Cart_Item_sizeId_fkey")
}

model category {
  id      Int       @id @default(autoincrement())
  name    String
  product product[]
}

model color {
  id               Int                @id @default(autoincrement())
  name             String
  cart_item        cart_item[]
  order_item       order_item[]
  product_quantity product_quantity[]
}

model customer {
  id             Int              @id @default(autoincrement())
  created_at     DateTime         @default(now())
  deleted_at     DateTime?
  cart_item      cart_item[]
  customer_likes customer_likes[]
  order          order[]
  user           User             @relation(fields: [userId], references: [id])
  userId         Int              @unique
}

model customer_likes {
  id         Int      @id @default(autoincrement())
  customerId Int
  productId  Int
  customer   customer @relation(fields: [customerId], references: [id], map: "Customer_Likes_customerId_fkey")
  product    product  @relation(fields: [productId], references: [id], map: "Customer_Likes_productId_fkey")

  @@unique([customerId, productId], name: "customerId_productId")
  @@index([customerId], map: "Customer_Likes_customerId_fkey")
  @@index([productId], map: "Customer_Likes_productId_fkey")
}

model order {
  id              Int         @id @default(autoincrement())
  customerId      Int?
  amount          Int         // Total amount in cents
  currency        String
  status          OrderStatus @default(PENDING)
  paymentIntentId String      @unique
  customerDetails Json?       // Store Stripe customer_details JSON
  shippingDetails Json?       // Store Stripe shipping JSON
  created_at      DateTime    @default(now())
  deleted_at      DateTime?
  customer        customer?   @relation(fields: [customerId], references: [id], map: "Order_customerId_fkey")
  order_item      order_item[]
  discountAmount  Int         @default(0)
  giftCardCode    String?

  @@index([customerId], map: "Order_customerId_fkey")
}

model GiftCard {
  id            Int       @id @default(autoincrement())
  code          String    @unique
  balance       Int       // Remaining balance in cents
  initialAmount Int       // Original amount in cents
  isEnabled     Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model order_item {
  id          Int      @id @default(autoincrement())
  orderId     Int
  productId   Int
  sizeId      Int?    // Made nullable
  colorId     Int?    // Made nullable
  quantity    Int
  price       Int     // Store item price in cents
  order       order    @relation(fields: [orderId], references: [id], map: "Order_Item_orderId_fkey")
  product     product  @relation(fields: [productId], references: [id], map: "Order_Item_productId_fkey")
  color       color?   @relation(fields: [colorId], references: [id], map: "Order_Item_colorId_fkey") // Relation can be nullable
  size        size?    @relation(fields: [sizeId], references: [id], map: "Order_Item_sizeId_fkey") // Relation can be nullable

  @@index([colorId], map: "Order_Item_colorId_fkey")
  @@index([orderId], map: "Order_Item_orderId_fkey")
  @@index([productId], map: "Order_Item_productId_fkey")
  @@index([sizeId], map: "Order_Item_sizeId_fkey")
}

model product {
  id               Int                @id @default(autoincrement())
  name             String
  description      String?
  price            Float
  offer_price      Float?
  status           ProductStatus      @default(DRAFT)
  category_Id      Int
  deleted_at       DateTime?
  varenummer       String?
  barkode          String?
  images           ProductImage[]
  cart_item        cart_item[]
  customer_likes   customer_likes[]
  order_item       order_item[]
  category         category           @relation(fields: [category_Id], references: [id], map: "Product_category_Id_fkey")
  product_quantity product_quantity[]
  shipment_size    shipment_size?

  @@index([category_Id], map: "Product_category_Id_fkey")
}

model ProductImage {
  id          Int     @id @default(autoincrement())
  url         String
  isThumbnail Boolean @default(false)
  product     product @relation(fields: [productId], references: [id])
  productId   Int

  @@index([productId])
}

model product_quantity {
  id        Int     @id @default(autoincrement())
  productId Int
  sizeId    Int
  colorId   Int
  quantity  Int
  color     color   @relation(fields: [colorId], references: [id], map: "Product_Quantity_colorId_fkey")
  product   product @relation(fields: [productId], references: [id], map: "Product_Quantity_productId_fkey")
  size      size    @relation(fields: [sizeId], references: [id], map: "Product_Quantity_sizeId_fkey")

  @@index([colorId], map: "Product_Quantity_colorId_fkey")
  @@index([productId], map: "Product_Quantity_productId_fkey")
  @@index([sizeId], map: "Product_Quantity_sizeId_fkey")
}

model size {
  id               Int                @id @default(autoincrement())
  name             String
  cart_item        cart_item[]
  order_item       order_item[]
  product_quantity product_quantity[]
}

model shipment_size {
  id        Int     @id @default(autoincrement())
  weight    Float?
  height    Float?
  width     Float?
  product   product @relation(fields: [productId], references: [id])
  productId Int     @unique
}

enum ProductStatus {
  ONLINE
  OFFLINE
  DRAFT
}

enum OrderStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELED
}

enum Role {
  ADMIN
  USER
}

model User {
  id       Int       @id @default(autoincrement())
  name     String
  email    String    @unique
  password String
  role     Role      @default(USER)
  customer customer?
}
